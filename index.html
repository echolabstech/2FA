<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>2FA Demo</title>
</head>
<body>
	
<script src="https://unpkg.com/@otplib/preset-browser@^12.0.0/buffer.js"></script>
<script src="https://unpkg.com/@otplib/preset-browser@^12.0.0/index.js"></script>
<script type="text/javascript">
	function validate(token, secret) {
		const isTokenValid = otplib.totp.check(token, secret);
		if (isTokenValid) {
			const options = {
				method: 'post',
				headers: {
					'Content-Type': 'text/html',
		    },
				body: token,
			};
			return fetch('http://localhost:3000/auth', options);
		}
		return isTokenValid;
	}

	const secret = 'KVKFKRCPNZQUYMLXOVYDSQKJKZDTSRLD';
	const token = otplib.totp.generate(secret);
	const isTOTPValid = validate(token, secret);
	if (isTOTPValid) {
		isTOTPValid.then(res => res.text())
		.then(text => console.log(text))
		.catch(err => console.error(err));
	} else {
		console.log('validation failed');
	}
</script>
</body>
</html>